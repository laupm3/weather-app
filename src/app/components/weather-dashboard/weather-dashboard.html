<div class="dashboard-container" [ngClass]="getWeatherClass()">
    <!-- Atmospheric Layer -->
    <div class="background-blobs">
        <div class="blob blob-1"></div>
        <div class="blob blob-2"></div>
        <div class="blob blob-3"></div>
    </div>

    <div class="inner-content">
        <header class="dashboard-header">
            <div class="header-main">
                <h1>{{ langService.get('APP_TITLE') }}</h1>
                <div class="header-actions">
                    <div class="unit-toggle" (click)="toggleUnits()"
                        [title]="'Switch to ' + (units === 'metric' ? 'Fahrenheit' : 'Celsius')">
                        <div class="toggle-track">
                            <div class="toggle-thumb" [class.imperial]="units === 'imperial'"></div>
                        </div>
                        <span [class.active]="units === 'metric'">°C</span>
                        <span [class.active]="units === 'imperial'">°F</span>
                    </div>
                    <!-- Language Switcher -->
                    <div class="lang-switcher" (click)="langService.toggleLang()">
                        <span [class.active]="langService.getCurrentLang() === 'en'">EN</span>
                        <span [class.active]="langService.getCurrentLang() === 'es'">ES</span>
                    </div>
                </div>
            </div>
            <app-search-bar (citySearch)="handleCitySearch($event)"></app-search-bar>

            <div *ngIf="favoriteWeatherData.length > 0" class="quick-access">
                <span class="section-label">{{ langService.get('QUICK_ACCESS') }}</span>
                <div class="fav-ribbon">
                    <div *ngFor="let fav of favoriteWeatherData" class="fav-tile" (click)="handleCitySearch(fav.name)">
                        <button class="tile-remove" (click)="removeFavorite(fav.name, $event)"
                            [title]="langService.get('REMOVE')">
                            &times;
                        </button>
                        <div class="tile-body">
                            <app-weather-icon [iconCode]="fav.weather[0].icon" [size]="40"></app-weather-icon>
                            <div class="tile-temp-group">
                                <span class="tile-temp">{{ fav.main.temp | number:'1.0-0' }}°</span>
                                <span class="tile-units">{{ units === 'metric' ? 'C' : 'F' }}</span>
                            </div>
                        </div>
                        <div class="tile-header">
                            <span class="tile-city">{{ fav.name }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <main class="dashboard-content">

            <div *ngIf="error" class="error-message">
                {{ error }}
            </div>

            <div class="weather-display" *ngIf="weatherData || loading">
                <app-weather-card [weatherData]="weatherData" [units]="units" [loading]="loading"
                    (favoriteToggled)="favoritesService.refresh()">
                </app-weather-card>

                <div class="forecast-section" *ngIf="forecastData || loading">
                    <div class="forecast-top">
                        <app-hourly-chart [forecastData]="forecastData!" [units]="units"
                            [loading]="loading"></app-hourly-chart>
                        <app-sun-arch [weatherData]="weatherData" [loading]="loading"></app-sun-arch>
                    </div>
                    <app-forecast [forecastData]="forecastData" [units]="units" [loading]="loading"></app-forecast>
                </div>
            </div>

            <div *ngIf="!loading && !weatherData && !error" class="welcome-message">
                <p>{{ langService.get('WELCOME_MSG') }}</p>
            </div>
        </main>
    </div>
</div>